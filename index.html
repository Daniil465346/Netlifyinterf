<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .integration-flow {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }

        .flow-number {
            background: white;
            color: #667eea;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }

        input, select, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background: #0056b3;
        }

        .result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f8f9fa;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }

        .notification {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background: #28a745;
        }

        .status-inactive {
            background: #dc3545;
        }

        .api-status {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }

        .email-info {
            background: #e7f3ff;
            border: 2px solid #007bff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üöÄ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</h1>

    <div class="integration-flow">
        <h3>üîó –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã</h3>
        <div class="flow-step">
            <div class="flow-number">1</div>
            <div>–°–æ–∑–¥–∞–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –ø–æ–∫—É–ø–∫–∏ –∞–∫—Ü–∏–π</div>
        </div>
        <div class="flow-step">
            <div class="flow-number">2</div>
            <div>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é —Ü–µ–Ω—É –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞</div>
        </div>
        <div class="flow-step">
            <div class="flow-number">3</div>
            <div>–ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞ ‚Üí –ø–∏—Å—å–º–æ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email</div>
        </div>
    </div>

    <div class="dashboard">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div>
            <!-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
            <div class="section">
                <h3>üìß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏</h3>
                <div class="api-status">
                    <span>–¢–µ–∫—É—â–∏–π email:</span>
                    <span id="currentEmail">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div class="api-status">
                    <span>–°—Ç–∞—Ç—É—Å Email API:</span>
                    <span id="emailApiStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                </div>
                <input type="email" id="userEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π">
                <button onclick="sendTestEmail()">üß™ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ</button>
                <div id="emailResult" class="result"></div>
            </div>

            <div class="section">
                <h3>üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤</h3>
                <div class="api-status">
                    <span>Investment API:</span>
                    <span><span class="status-indicator" id="investmentStatus"></span> <span id="investmentStatusText">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></span>
                </div>
                <div class="api-status">
                    <span>Email Service:</span>
                    <span><span class="status-indicator" id="emailStatus"></span> <span id="emailStatusText">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></span>
                </div>
                <button onclick="checkServices()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            </div>

            <div class="section">
                <h3>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                <select id="calcSecurityId" onchange="updatePrices()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±—É–º–∞–≥—É</option>
                </select>
                <input type="number" id="calcQuantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="10">
                <input type="number" id="calcCurrentPrice" placeholder="–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞" step="0.01" readonly>
                <input type="number" id="calcCommission" placeholder="–ö–æ–º–∏—Å—Å–∏—è" value="5.00" step="0.01">
                <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å</button>
                <div id="calcResult" class="result"></div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div>
            <div class="section">
                <h3>üíæ –ù–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è</h3>
                <select id="opSecurityId">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±—É–º–∞–≥—É</option>
                </select>
                <input type="number" id="opQuantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="10">
                <input type="number" id="opPrice" placeholder="–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏" step="0.01">
                <input type="number" id="opCommission" placeholder="–ö–æ–º–∏—Å—Å–∏—è" value="5.00" step="0.01">
                <input type="number" id="opTargetPrice" placeholder="–¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞ –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞" step="0.01">
                <input type="email" id="opEmail" placeholder="Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
                <button onclick="addOperation()">üìß –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</button>
                <div id="opResult" class="result"></div>
            </div>

            <div class="section">
                <h3>üîç –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã</h3>
                <button onclick="getActiveTriggers()">–ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞</button>
                <button onclick="checkAllTriggers()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã</button>
                <div id="triggersResult" class="result"></div>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>üìà –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
        <button onclick="getOperations()">–û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        <div id="operationsResult" class="result"></div>
    </div>

    <script>
        const INVESTMENT_API = 'https://pr4-daniil465346.amvera.io/api/investment';
        const EMAIL_API = 'http://apisendemail-oribon.amvera.io/sendEmail'; // –í–∞—à API
        let securities = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function loadSecurities() {
            try {
                const response = await fetch(`${INVESTMENT_API}/securities`);
                securities = await response.json();

                securities.forEach(security => {
                    const option = `<option value="${security.id}">${security.ticker} - $${security.currentPrice}</option>`;
                    document.getElementById('calcSecurityId').innerHTML += option;
                    document.getElementById('opSecurityId').innerHTML += option;
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—É–º–∞–≥:', error);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
        async function checkServices() {
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ Investment API
                const investmentResponse = await fetch(`${INVESTMENT_API}/securities`);
                const investmentOk = investmentResponse.ok;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ Email API
                const emailResponse = await fetch(`${EMAIL_API}/status`);
                const emailOk = emailResponse.ok;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ Investment API
                document.getElementById('investmentStatus').className = `status-indicator ${investmentOk ? 'status-active' : 'status-inactive'}`;
                document.getElementById('investmentStatusText').textContent = investmentOk ? 'Online' : 'Offline';
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ Email API
                document.getElementById('emailStatus').className = `status-indicator ${emailOk ? 'status-active' : 'status-inactive'}`;
                document.getElementById('emailStatusText').textContent = emailOk ? 'Online' : 'Offline';

                if (investmentOk && emailOk) {
                    showResult('emailResult', '‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!', true);
                } else {
                    showResult('emailResult', '‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', false);
                }
            } catch (error) {
                document.getElementById('investmentStatus').className = 'status-indicator status-inactive';
                document.getElementById('investmentStatusText').textContent = 'Offline';
                document.getElementById('emailStatus').className = 'status-indicator status-inactive';
                document.getElementById('emailStatusText').textContent = 'Offline';
                showResult('emailResult', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞', false);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω
        function updatePrices() {
            const security = securities.find(s => s.id == document.getElementById('calcSecurityId').value);
            if (security) {
                document.getElementById('calcCurrentPrice').value = security.currentPrice;
                document.getElementById('opPrice').value = security.currentPrice;
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–ª–µ–≤—É—é —Ü–µ–Ω—É –Ω–∞ 10% –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π
                document.getElementById('opTargetPrice').value = (security.currentPrice * 0.9).toFixed(2);
            }
        }

        // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
        async function calculate() {
            const securityId = document.getElementById('calcSecurityId').value;
            const quantity = document.getElementById('calcQuantity').value;
            const price = document.getElementById('calcCurrentPrice').value;
            const commission = document.getElementById('calcCommission').value;

            if (!securityId) return showResult('calcResult', '–í—ã–±–µ—Ä–∏—Ç–µ –±—É–º–∞–≥—É', false);

            try {
                const response = await fetch(`${INVESTMENT_API}/calculate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        securityId: parseInt(securityId),
                        quantity: parseInt(quantity),
                        purchasePricePerShare: parseFloat(price),
                        commission: parseFloat(commission)
                    })
                });

                const result = await response.json();
                const security = securities.find(s => s.id == securityId);

                document.getElementById('calcResult').innerHTML =
                    `<strong>${security.ticker}: $${result.totalCost}</strong><br>
                     üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${quantity} –∞–∫—Ü–∏–π<br>
                     üíµ –¶–µ–Ω–∞: $${price}<br>
                     üìã –ö–æ–º–∏—Å—Å–∏—è: $${commission}`;
                document.getElementById('calcResult').className = 'result success';

            } catch (error) {
                showResult('calcResult', '‚ùå –û—à–∏–±–∫–∞: ' + error.message, false);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π email
        async function addOperation() {
            const securityId = document.getElementById('opSecurityId').value;
            const quantity = document.getElementById('opQuantity').value;
            const price = document.getElementById('opPrice').value;
            const commission = document.getElementById('opCommission').value;
            const targetPrice = document.getElementById('opTargetPrice').value;
            const email = document.getElementById('opEmail').value.trim();

            if (!securityId) return showResult('opResult', '‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –±—É–º–∞–≥—É', false);
            if (!email || !email.includes('@')) return showResult('opResult', '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email', false);

            const operation = {
                securityId: parseInt(securityId),
                quantity: parseInt(quantity),
                purchasePricePerShare: parseFloat(price),
                commission: parseFloat(commission),
                targetBuyPrice: parseFloat(targetPrice)
            };

            try {
                showResult('opResult', 'üîÑ –°–æ–∑–¥–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é...', true);
                
                // –°–æ–∑–¥–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–º API
                const response = await fetch(`${INVESTMENT_API}/operation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(operation)
                });

                const result = await response.json();
                
                let message = result.message;

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º email —á–µ—Ä–µ–∑ –≤–∞—à API
                if (result.triggerActivated || true) { // –í—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º email –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                    try {
                        const emailResponse = await fetch(`${EMAIL_API}/send-email`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                to: email,
                                subject: `–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è - ${securities.find(s => s.id == securityId).ticker}`,
                                message: `–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è:\n\n–ê–∫—Ü–∏—è: ${securities.find(s => s.id == securityId).ticker}\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${quantity}\n–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: $${price}\n–¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞: $${targetPrice}\n–ö–æ–º–∏—Å—Å–∏—è: $${commission}\n\n–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: $${(quantity * price + parseFloat(commission)).toFixed(2)}`
                            })
                        });

                        const emailResult = await emailResponse.json();
                        
                        if (emailResponse.ok) {
                            message += `\n\nüìß –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ ${email}`;
                        } else {
                            message += `\n\n‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email: ${emailResult.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                        }
                    } catch (emailError) {
                        message += `\n\n‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å email —Å–µ—Ä–≤–∏—Å–æ–º`;
                    }
                }

                if (result.triggerActivated) {
                    message += '\n\nüö® –¢–†–ò–ì–ì–ï–† –°–†–ê–ë–û–¢–ê–õ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É.';
                }

                showResult('opResult', message, true);
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ email –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
                document.getElementById('opEmail').value = '';
                
            } catch (error) {
                showResult('opResult', '‚ùå –û—à–∏–±–∫–∞: ' + error.message, false);
            }
        }

        // –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
        async function getActiveTriggers() {
            try {
                const response = await fetch(`${INVESTMENT_API}/active-triggers`);
                const triggers = await response.json();

                const result = document.getElementById('triggersResult');
                if (triggers.length > 0) {
                    result.innerHTML = triggers.map(t => `
                        <div class="notification">
                            <strong>${t.securityTicker}</strong><br>
                            ${t.message}<br>
                            <small>üéØ –¶–µ–ª—å: $${t.targetPrice} | üìä –¢–µ–∫—É—â–∞—è: $${t.currentPrice}</small>
                        </div>
                    `).join('');
                } else {
                    result.innerHTML = '‚úÖ –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤';
                    result.className = 'result success';
                }

            } catch (error) {
                showResult('triggersResult', '‚ùå –û—à–∏–±–∫–∞: ' + error.message, false);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
        async function checkAllTriggers() {
            try {
                const response = await fetch(`${INVESTMENT_API}/check-all-triggers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                let message = `üîç –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤: ${result.totalChecked}\n`;
                message += `üö® –°—Ä–∞–±–æ—Ç–∞–ª–æ: ${result.activatedTriggers.length}\n`;
                message += `‚è∞ –í—Ä–µ–º—è: ${new Date(result.checkedAt).toLocaleString()}`;

                showResult('triggersResult', message, true);

            } catch (error) {
                showResult('triggersResult', '‚ùå –û—à–∏–±–∫–∞: ' + error.message, false);
            }
        }

        // –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
        async function getOperations() {
            try {
                const response = await fetch(`${INVESTMENT_API}/operations`);
                const data = await response.json();

                if (data.length > 0) {
                    const operationsList = data.map(op => 
                        `#${op.id} ${op.securityTicker} - ${op.quantity}—à—Ç √ó $${op.purchasePricePerShare} = $${op.totalCost}` +
                        (op.targetBuyPrice ? ` üéØ –¢—Ä–∏–≥–≥–µ—Ä: $${op.targetBuyPrice}` : '')
                    ).join('\n');
                    
                    showResult('operationsResult', operationsList, true);
                } else {
                    showResult('operationsResult', 'üì≠ –ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π', true);
                }
            } catch (error) {
                showResult('operationsResult', '‚ùå –û—à–∏–±–∫–∞: ' + error.message, false);
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∏—Å—å–º–∞ —á–µ—Ä–µ–∑ –≤–∞—à API
        async function sendTestEmail() {
            const email = document.getElementById('userEmail').value.trim();
            
            if (!email || !email.includes('@')) {
                showResult('emailResult', '‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å', false);
                return;
            }

            try {
                showResult('emailResult', 'üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ...', true);
                
                const response = await fetch(`${EMAIL_API}/send-email`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        to: email,
                        subject: '–¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã',
                        message: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üéâ\n\n–í—ã —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö.'
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    showResult('emailResult', 
                        `‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ ${email}!\n\n–°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message || '–ü–∏—Å—å–º–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'}`, 
                        true);
                    document.getElementById('currentEmail').textContent = email;
                    document.getElementById('userEmail').value = '';
                } else {
                    showResult('emailResult', `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, false);
                }
            } catch (error) {
                showResult('emailResult', '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å email —Å–µ—Ä–≤–∏—Å–æ–º', false);
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        function showResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ email —Å—Ç–∞—Ç—É—Å–∞
        async function loadCurrentEmail() {
            try {
                const response = await fetch(`${EMAIL_API}/status`);
                if (response.ok) {
                    document.getElementById('emailApiStatus').textContent = '–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
                    document.getElementById('emailApiStatus').style.color = 'green';
                } else {
                    document.getElementById('emailApiStatus').textContent = '–ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
                    document.getElementById('emailApiStatus').style.color = 'red';
                }
            } catch (error) {
                document.getElementById('emailApiStatus').textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                document.getElementById('emailApiStatus').style.color = 'red';
            }
        }

        // –ó–∞–ø—É—Å–∫
        loadSecurities();
        checkServices();
        getActiveTriggers();
        getOperations();
        loadCurrentEmail();
    </script>
</body>
</html>


